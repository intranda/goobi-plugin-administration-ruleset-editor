<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:composite="http://xmlns.jcp.org/jsf/composite"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites"
	xmlns:jsf="http://xmlns.jcp.org/jsf"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:x="http://myfaces.apache.org/tomahawk">

	<composite:interface>
	</composite:interface>

	<composite:implementation>
		<link rel="stylesheet" href="template/css/codemirror/codemirror.css?v=#{HelperForm.buildVersion}"/>
		<script type="text/javascript" src="template/js/codemirror/codemirror.js?v=#{HelperForm.buildVersion}"/>
		<script type="text/javascript" src="template/js/codemirror/mode/xml/xml.js?v=#{HelperForm.buildVersion}"/>
		<script type="text/javascript" src="plugin_administration_ruleset_edition.js" />
		<!-- Without permission -->
		<h:panelGroup rendered="#{!LoginForm.hasRole('Plugin_administration_ruleset_edition')}">
			<div class="row">
				<div class="col-sm-12">
					<div class="box box-color box-bordered lightgrey">
						<div class="box-title">
							<h3>
								<i class="fa fa-plug"></i>
								<h:outputText
									value="#{msgs[AdministrationForm.administrationPlugin.title]}" />
							</h3>
						</div>
						<div class="box-content">
							<h:outputText
								styleClass="alert alert-danger alert-dismissable margin-bottom-10 margin-top-10"
								value="#{msgs.plugin_administration_missingPermission} Plugin_administration_ruleset_edition"></h:outputText>
						</div>
					</div>
				</div>
			</div>
		</h:panelGroup>

		<!-- With permission -->
		<h:panelGroup rendered="#{LoginForm.hasRole('Plugin_administration_ruleset_edition')}">
			<div class="row">
				<h:form id="rulesetEditorForm">
					<div class="col-sm-4">
						<div class="box box-color box-bordered">
							<div class="box-title">
								<h3>
									<i class="fa fa-files-o"></i>
									<h:outputText value="#{msgs.rulesetSelection}" />
								</h3>
							</div>
							<div class="box-content nopadding">
								<!-- Table with rule set file -->
								<h:dataTable id="ruleset_table" styleClass="table table-hover table-nomargin dataTable table-bordered responsive" var="item"
									value="#{AdministrationForm.administrationPlugin.rulesets}" varStatus="status">
									<h:column>
										<f:facet name="header">
											<h:outputText value="#{msgs.rulesetTitle}" />
										</f:facet>
										<h:outputText value="#{item.titel}"/>
									</h:column>
									<h:column>
										<f:facet name="header">
											<h:outputText value="#{msgs.rulesetFile}" />
										</f:facet>
										<h:outputText value="#{item.datei}" />
									</h:column>
									<h:column>
										<f:facet name="header">
											<h:outputText value="#{msgs.zuletztBearbeitet}" />
										</f:facet>
										<h:outputText value="#{AdministrationForm.administrationPlugin.rulesetDates.get(status.index)}" />
									</h:column>
									<h:column>
										<f:facet name="header">
											<h:outputText value="#{msgs.auswahl}" />
										</f:facet>
										<!-- Edit-Ruleset-Button -->
										<h:panelGroup rendered="#{AdministrationForm.administrationPlugin.currentRuleset == null}">
											<button
												jsf:id="edit"
												class="btn margin-sides-5 #{AdministrationForm.administrationPlugin.isActiveRuleset(item) ? 'btn-primary' : ''}"
												title="#{msgs.regelsatzBearbeiten}"
												jsf:rel="tooltip"
												jsf:action="#{AdministrationForm.administrationPlugin.editRuleset(item)}">
												<i class="fa fa-pencil"></i>
												<f:ajax render="rulesetEditorForm" />
											</button>
										</h:panelGroup>
										<h:panelGroup rendered="#{AdministrationForm.administrationPlugin.currentRuleset != null}">
                                            <button
												jsf:id="edit2"
												class="btn margin-sides-5 #{AdministrationForm.administrationPlugin.isActiveRuleset(item) ? 'btn-primary' : ''}"
												type="button"
												jsf:onclick="loadEditorContent()"
												jsf:action="#{AdministrationForm.administrationPlugin.editRuleset(item)}"
												title="#{msgs.regelsatzBearbeiten}">
												<i class="fa fa-pencil"></i>
												<f:ajax render="@form" execute="@form" />
											</button>
										</h:panelGroup>
									</h:column>
								</h:dataTable>
							</div>
						</div>
						<!--
						<div class="box box-color box-bordered lightgrey">
							<div class="box-title">
								<h3>
									<i class="fa fa-bar-chart"></i>
									<h:outputText
										value="#{msgs.validationResult}" />
								</h3>
							</div>
							<div class="box-content">
								<h:panelGroup id="actionform" styleClass="col-sm-12">
									<div class="row">
									</div>
								</h:panelGroup>
							</div>
						</div>
						-->
					</div>
					<div class="col-sm-8">
						<h:panelGroup rendered="#{AdministrationForm.administrationPlugin.currentRuleset != null}">
							<div class="box box-color box-bordered orange">
								<div class="box-title">
									<h3>
										<i class="fa fa-wrench"></i>
										<h:outputText value="#{AdministrationForm.administrationPlugin.currentEditorTitle}" />
									</h3>
								</div>
								<div class="box-content" id="boxUntilBottom">
									<h:panelGroup rendered="false">
										<!-- Ignore-Button -->
									</h:panelGroup>
									<!-- The message area for saved-successfully-messages -->
									<h:messages
										for="rulesetEditor"
										escape="false"
										errorClass="alert alert-danger"
										infoClass="alert alert-info"
										warnClass="alert"
										showDetail="true"
										showSummary="true"
										tooltip="true"
										styleClass="messages"
										style="float: left" />
									<!-- Buttons on top of text editor -->
									<div class="form-actions">
										<!-- Save-Button -->
										<button
											jsf:id="save"
											class="btn btn-success pull-right font-size-s margin-bottom-most"
											jsf:action="#{AdministrationForm.administrationPlugin.save}"
											title="#{msgs.uebernehmen}"
											onclick="loadEditorContent()">
											<i class="fa fa-save margin-right-5"></i>
											<h:outputText value="#{msgs.save}" />
											<!--<f:ajax render="" />-->
										</button>
										<!-- Cancel-Button -->
										<button
											jsf:id="cancel"
											class="btn margin-sides-10 font-size-s pull-right"
											jsf:action="#{AdministrationForm.administrationPlugin.cancel}"
											title="#{msgs.cancel}">
											<h:outputText value="#{msgs.cancel}" />
											<f:ajax render="rulesetEditorForm" />
										</button>
									</div>
									<!-- Text editor -->
									<div
										id="rulesetEditorBorder"
										style="border: 1px solid #ddd;
										margin-top: 28px;">
										<x:inputTextarea
											id="rulesetEditor"
											style="resize: none;"
											pt:aria-label="rulesetEditor"
											forceId="true"
											styleClass="form-control"
											value="#{AdministrationForm.administrationPlugin.currentRulesetFileContent}" />
									</div>
									<script type="text/javascript">
										initRulesetEditor();
									</script>
								</div>
							</div>
						</h:panelGroup>
						<!-- Box for non-selected file -->
						<h:panelGroup rendered="#{AdministrationForm.administrationPlugin.currentRuleset == null}">
							<div class="box thin-margin lightgrey box-bordered">
								<div
									class="box-title"
									style="background-color: #eee;">
									<h2 class="tableColumnMaxWidthExtraLong">
										<i class="fa fa-wrench"></i> #{msgs.noFileSelected}
									</h2>
								</div>
								<div class="box-content nopadding">
									<div style="background-color: #eee; height: 250px;">
									</div>
								</div>
							</div>
						</h:panelGroup>
					</div>
					<div
						class="modal fade" id="saveDialog" tabindex="-1" role="modal" aria-labelledby="myDialogLabel"
						jsf:rendered="#{AdministrationForm.administrationPlugin.rulesetContentChanged}">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<h4 class="modal-title" id="myDialogLabel">
										<h:outputText value="#{msgs.unsaved_changes}" />
									</h4>
								</div>
								<div class="modal-body">
									<p>#{msgs.save_unsaved_changes}</p>
								</div>
								<div class="modal-footer">
									<div class="btn-group">
										<button
											type="button"
											class="btn margin-sides-10"
											style="width: 120px !important"
											data-dismiss="modal"
											aria-hidden="true">
											#{msgs.cancel}
										</button>
										<button
											class="btn margin-sides-10"
											style="width: 120px !important"
                                            jsf:id="ignoreChangedFile"
											jsf:action="#{AdministrationForm.administrationPlugin.editRulesetIgnore}">
											#{msgs.no}
										</button>
										<button
											class="btn margin-sides-10 btn-success"
											style="width: 120px !important"
                                            jsf:id="saveWhenChangedFile"
											jsf:action="#{AdministrationForm.administrationPlugin.saveAndChangeRuleset}">
											#{msgs.yes}
										</button>
									</div>
								</div>
							</div>
						</div>
					</div>
                    <div jsf:id="test" jsf:rendered="#{AdministrationForm.administrationPlugin.rulesetContentChanged}">
                        <script>
                        	$('#saveDialog').modal('show')
                        </script>
                    </div>
				</h:form>
			</div>
		</h:panelGroup>
	</composite:implementation>
</ui:composition>